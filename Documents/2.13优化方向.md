# 2.13 项目优化方向规划

## 1. 现状回顾 (MVP 1.0)
截止目前，我们已经成功搭建了 **GraphRAG 问答系统的最小可行性产品 (MVP)**，涵盖了从数据入库到前端交互的全流程：
*   **图谱构建**: 实现了基于结构化数据（JSON/CSV）的 Neo4j 批量导入。
*   **RAG 引擎**: 实现了 "意图识别 -> Cypher 模板检索 -> LLM 回答" 的核心链路。
*   **应用交付**: 提供了 FastAPI 后端与 Streamlit 前端，并实现了知识溯源展示。

**✅ 课题要求达成度**:
*   已达成: 跨域图谱构建（基础）、GraphRAG 流程跑通、用户界面、答案溯源。
*   待提升: 非结构化文本抽取、检索的语义理解能力、多轮对话能力。

---

## 2. 差距分析 (Gap Analysis)

结合课题要求，目前系统存在以下改进空间：

| 维度 | 当前状态 | 课题要求/加分项 | 差距 |
| :--- | :--- | :--- | :--- |
| **数据源处理** | 主要依赖清洗好的结构化数据 (JSON/CSV) | **从文本中提取三元组** (如保险条款) | 缺乏非结构化文本的信息抽取 (IE) 模块，无法自动处理长文本保险条款。 |
| **检索能力** | 仅支持关键词精确匹配 (Cypher) | **混合检索** (向量 + 结构) | 当用户提问词汇（如"心脑血管病"）与图谱实体（"高血压"）不完全一致时，可能检索失败。 |
| **对话能力** | 单轮问答，无上下文记忆 | **多轮对话** (状态跟踪) | 无法处理用户的追问 (e.g., "那费用呢？")。 |
| **评估验证** | 人工主观判断 | **对比实验** | 缺乏量化指标证明 GraphRAG 优于纯 LLM。 |

---

## 3. 下一步优化方案 (Optimization Roadmap)

### 🚀 方向一：引入非结构化文本抽取 (LLM-based IE)
**目标**: 满足课题中"从文本中提取三元组"的要求，增强图谱的丰富度。
**行动计划**:
1.  **数据准备**: 收集真实的保险条款文本（PDF转Text或TXT）。
2.  **Pipeline 开发**: 开发一个新的 `text_loader.py`。
    *   使用 LLM (DeepSeek) 读取长文本。
    *   设计 Prompt 让 LLM 自动提取 `(Insurance)-[:COVERS]->(Disease)` 或 `(Insurance)-[:LIMIT_AGE]->(AgeRange)` 等三元组。
    *   输出标准 JSON 格式并存入 Neo4j。
3.  **实体对齐**: 简单的归一化处理（例如将 LLM 提取的 "原发性高血压" 映射为库中已有的 "高血压"）。

### 🔍 方向二：实现混合检索 (Hybrid Search) —— **高优先级加分项**
**目标**: 提升检索的召回率，解决术语不匹配问题。
**行动计划**:
1.  **向量化 (Embedding)**:
    *   使用 Embedding 模型 (如 `text-embedding-3-small` 或开源 `bge-m3`) 将图谱中的实体名称、描述、保险条款转为向量。
    *   存储于 Neo4j (支持 Vector Index) 或轻量级向量库 (ChromaDB)。
2.  **检索逻辑升级**:
    *   `GraphRetriever` 增加向量检索分支：用户问题 -> 向量 -> Top-K 相似节点。
    *   **融合策略**: 将 向量检索结果 (模糊匹配) 与 Cypher 查询结果 (精确匹配) 合并，作为 Context 输入给 LLM。

### 💬 方向三：支持多轮对话 (Multi-turn Conversation)
**目标**: 提升用户体验，满足"拓展方向"要求。
**行动计划**:
1.  **后端改造**: `RAGEngine` 增加 `history` 参数或 Session 管理。
2.  **意图理解升级**: `QueryParser` 需要结合历史记录来补全当前问题（例如用户问"多少钱"，需结合上一轮"养老院"补全为"养老院价格"）。
3.  **前端适配**: Streamlit 保持会话状态，将历史消息传给后端。

### 📊 方向四：对比实验与评估
**目标**: 为技术报告提供数据支持。
**行动计划**:
1.  **构建测试集**: 准备 10-20 个具有挑战性的问题（涉及跨域知识、数值比较等）。
2.  **对照组设置**:
    *   Group A: 纯 LLM (DeepSeek 直接回答，不给 Context)。
    *   Group B: GraphRAG (当前系统)。
3.  **指标**: 事实准确性 (是否有幻觉)、答案完整性。
4.  **成果**: 整理成图表放入最终报告。

---

## 4. 建议执行顺序

1.  **Week 1**: **混合检索 (方向二)**。这是提升系统智能度最明显的点，且技术栈兼容性好。
2.  **Week 2**: **非结构化抽取 (方向一)**。补充数据，体现技术深度。
3.  **Week 3**: **多轮对话 & 评估 (方向三 & 四)**。完善体验，准备结题报告数据。
